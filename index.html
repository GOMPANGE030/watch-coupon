<!-- 
YouTube ì‹œì²­-ì¿ í° ë°œê¸‰ (íŒì—… ìƒˆì°½ ë²„ì „)
ì„¤ëª…: ì‹œì²­ ì‹œê°„ ë‹¬ì„± í›„ ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ í´ë¦­í•´ì•¼ ìƒˆ ì°½ì´ ì—´ë¦½ë‹ˆë‹¤(íŒì—… ì°¨ë‹¨ íšŒí”¼).
íŒŒì¼ êµ¬ì„±: index.html + coupon.html ë‘ ê°œë¥¼ ê°™ì€ ì €ì¥ì†Œ ë£¨íŠ¸ì— ë‘ì„¸ìš”.
-->

========================
index.html
========================
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>ì˜ìƒ ì‹œì²­ í›„ ì¿ í° ë°›ê¸° (ëª¨ë°”ì¼ ìµœì í™”)</title>
  <style>
    :root{ --brand:#ff6b00; --bg:#0f1115; --text:#e8ecf1; --muted:#a5adba; --card:#171a21; }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .container{max-width:640px;margin:0 auto;padding:16px}
    .card{background:var(--card);border:1px solid #212532;border-radius:16px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px;font-size:20px}
    .muted{color:var(--muted);font-size:14px}
    .player-wrap{position:relative;border-radius:12px;overflow:hidden;background:#000}
    .player{width:100%;aspect-ratio:16/9}
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(0deg, rgba(0,0,0,.6), rgba(0,0,0,.4));}
    .btn{appearance:none;border:0;border-radius:14px;padding:14px 18px;font-weight:700;cursor:pointer;width:100%;font-size:16px}
    .btn-primary{background:var(--brand);color:#fff}
    .btn[disabled]{opacity:.5;cursor:not-allowed}
    .progress{height:10px;background:#232836;border-radius:999px;overflow:hidden;margin-top:12px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),#ffd29a)}
    .cta{margin-top:12px}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>ì˜ìƒ ì‹œì²­ í›„ ì¿ í° ë°›ê¸°</h1>
      <p class="muted">ì•„ë˜ ìœ íŠœë¸Œ ì˜ìƒì„ <strong id="needSec">10</strong>ì´ˆ ì‹œì²­í•˜ë©´ ì¿ í° ë§í¬ë¥¼ ë°›ì„ ìˆ˜ ìˆì–´ìš”.</p>

      <div class="player-wrap">
        <div id="player" class="player"></div>
        <div id="overlay" class="overlay">
          <button id="startBtn" class="btn btn-primary">â–¶ï¸ ì‹œì²­ ì‹œì‘</button>
        </div>
      </div>

      <div class="progress" aria-label="ì‹œì²­ ì§„í–‰ë¥ "><div id="bar" class="bar"></div></div>
      <div class="cta">
        <!-- ì™„ë£Œ í›„ ë‚˜íƒ€ë‚˜ë©°, ì‚¬ìš©ì í´ë¦­ ì‹œ ìƒˆ ì°½ìœ¼ë¡œ ì´ë™ (íŒì—… ì°¨ë‹¨ íšŒí”¼) -->
        <button id="openPopupBtn" class="btn btn-primary" style="display:none">ì¿ í° ë§í¬ ë°›ê¸°</button>
      </div>
      <p class="muted" style="font-size:12px;margin-top:8px">â€» íŒì—…ì€ ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œë§Œ ì—´ë¦½ë‹ˆë‹¤. ìë™ íŒì—…ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì°¨ë‹¨ë  ìˆ˜ ìˆì–´ìš”.</p>
    </div>
  </div>

  <script>
    /******** ì„¤ì • ********/
    const VIDEO_ID = "M7lc1UVf-VE";  // í…ŒìŠ¤íŠ¸ìš©
    const WATCH_THRESHOLD_SECONDS = 10; // ìš”ì²­: 10ì´ˆë¡œ ì¶•ì†Œ
    const COUPON_TARGET_URL = "https://example.com/promo"; // ì´ë™í•  ì‹¤ì œ ë§í¬ë¡œ êµì²´
    document.getElementById('needSec').textContent = WATCH_THRESHOLD_SECONDS;

    /******** ì—˜ë¦¬ë¨¼íŠ¸ ********/
    const $ = s=>document.querySelector(s);
    const overlay = $('#overlay');
    const startBtn = $('#startBtn');
    const bar = $('#bar');
    const openPopupBtn = $('#openPopupBtn');

    /******** YouTube IFrame API ********/
    let player, apiReady=false, watchTimer=null;
    let accumulated=0, lastTime=0, lastTickAt=0, rewarded=false;

    (function loadYT(){ const tag=document.createElement('script'); tag.src='https://www.youtube.com/iframe_api'; document.head.appendChild(tag); })();
    window.onYouTubeIframeAPIReady=()=>{
      apiReady=true;
      player=new YT.Player('player',{
        videoId:VIDEO_ID,
        width:'100%',height:'100%',
        playerVars:{controls:0,rel:0,fs:0,modestbranding:1,disablekb:1,playsinline:1},
        events:{onReady, onStateChange}
      });
    };

    function onReady(){ startBtn.disabled=false; }

    // íƒ­ ì´íƒˆ/í¬ì»¤ìŠ¤ ì•„ì›ƒ ì‹œ ì •ì§€ (ì‹œì²­ ê°€ì¥ ê·¼ì ‘ ê²€ì¦)
    document.addEventListener('visibilitychange',()=>{ if(document.hidden && player?.pauseVideo){ player.pauseVideo(); }});
    window.addEventListener('blur',()=>{ if(player?.pauseVideo){ player.pauseVideo(); }});

    startBtn.addEventListener('click',()=>{ if(!apiReady) return; overlay.style.display='none'; try{ player.playVideo(); }catch(e){} });

    function onStateChange(e){ const S=YT.PlayerState; if(e.data===S.PLAYING){ if(!watchTimer){ lastTime=player.getCurrentTime(); lastTickAt=performance.now(); watchTimer=setInterval(sample,250); }} else if(e.data===S.PAUSED||e.data===S.BUFFERING){ clearInterval(watchTimer); watchTimer=null; } else if(e.data===S.ENDED){ clearInterval(watchTimer); watchTimer=null; }}

    function sample(){
      const now=performance.now();
      const ct=player.getCurrentTime();
      const dt=(now-lastTickAt)/1000; // ê²½ê³¼
      let dHead=ct-lastTime;
      // ê³¼ë„ ì í”„ ë°©ì§€ (ì»¨íŠ¸ë¡¤ ìˆ¨ê¹€ + í‚¤ë³´ë“œ ë¹„í™œì„±í™”ì™€ í•¨ê»˜ ì‚¬ìš©)
      if(dHead>dt+0.75){ player.seekTo(lastTime,true); return; }
      if(dHead>0 && dHead<=dt+0.5){ accumulated+=Math.min(dHead,0.5); }
      const need=WATCH_THRESHOLD_SECONDS; const done=Math.min(accumulated,need);
      bar.style.width=`${(done/need)*100}%`;
      if(!rewarded && accumulated>=need){
        rewarded=true;
        // ë²„íŠ¼ í‘œì‹œ â†’ í´ë¦­ ì‹œ ìƒˆ ì°½ì˜ coupon.htmlë¡œ ì´ë™, ê·¸ í˜ì´ì§€ì—ì„œ ì‹¤ì œ í•˜ì´í¼ë§í¬ ì œê³µ
        openPopupBtn.style.display='block';
        openPopupBtn.focus();
      }
      lastTime=ct; lastTickAt=now;
    }

    // ìƒˆ ì°½ ì—´ê¸° (ì‚¬ìš©ì ì œìŠ¤ì²˜ ì•ˆì—ì„œë§Œ í˜¸ì¶œí•´ íŒì—… ì°¨ë‹¨ íšŒí”¼)
    openPopupBtn.addEventListener('click',()=>{
      const url = `coupon.html?url=${encodeURIComponent(COUPON_TARGET_URL)}`;
      const popup = window.open(url,'coupon','noopener,noreferrer,width=420,height=560');
      if(!popup){ alert('ë¸Œë¼ìš°ì €ì—ì„œ íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. í—ˆìš©í•´ ì£¼ì„¸ìš”.'); }
    });
  </script>
</body>
</html>


========================
coupon.html
========================
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>ì¿ í° ë§í¬</title>
  <style>
    :root{ --bg:#0f1115; --card:#171a21; --text:#e8ecf1; --muted:#9aa4b2; --brand:#ff6b00; }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{width:100%;max-width:440px;background:var(--card);border:1px solid #232b3a;border-radius:16px;padding:20px;text-align:center}
    h1{margin:0 0 6px;font-size:20px}
    p{margin:6px 0;color:var(--muted)}
    .link{display:inline-block;margin-top:14px;font-weight:800;text-decoration:underline;font-size:18px}
    .btn{display:block;width:100%;margin-top:12px;appearance:none;border:0;border-radius:12px;padding:14px 16px;font-weight:800;cursor:pointer;background:var(--brand);color:#fff;font-size:16px}
  </style>
</head>
<body>
  <main class="card">
    <h1>ì¿ í° ë§í¬ê°€ ì¤€ë¹„ë˜ì—ˆì–´ìš” ğŸ‰</h1>
    <p>ì•„ë˜ ë§í¬ ë¬¸êµ¬ë¥¼ ëˆ„ë¥´ë©´ í•´ë‹¹ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
    <a id="deepLink" class="link" href="#" rel="noopener noreferrer" target="_blank">í˜œíƒ ë°›ìœ¼ëŸ¬ ê°€ê¸°</a>
    <button id="go" class="btn">ë°”ë¡œ ì´ë™</button>
    <p style="font-size:12px">â€» ë³´ì•ˆì„ ìœ„í•´ ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ì—ì„œ ë§í¬ ìœ íš¨ì„±/1íšŒì„± ê²€ì¦ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
  </main>
  <script>
    const p=new URLSearchParams(location.search);
    const url=p.get('url');
    const a=document.getElementById('deepLink');
    const go=document.getElementById('go');
    if(url){ a.href=url; go.addEventListener('click',()=>{ location.href=url; }); }
    else{ a.textContent='ìœ íš¨í•œ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤'; a.removeAttribute('href'); go.disabled=true; }
  </script>
</body>
</html>
